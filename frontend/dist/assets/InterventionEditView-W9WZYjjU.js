import{d as D,z as E,r as h,f as w,g as N,h as k,o as A,c as i,a as t,p as a,t as l,x as T,m as L,n as u,s as _,q as c,v as m,k as M,y as B,b as n}from"./index-DoP8gccn.js";const O={class:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4 md:p-8"},U={class:"max-w-4xl mx-auto"},q={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},z={class:"flex items-center gap-3"},R={class:"text-2xl font-bold text-blue-800"},j={key:0,class:"mt-1 text-gray-600"},H={class:"bg-white rounded-xl shadow-md overflow-hidden"},F={key:0,class:"p-8 flex justify-center"},Y={class:"mb-6"},$={key:0,class:"mt-1 text-sm text-red-600"},G={class:"mb-6"},J={key:0,class:"mt-1 text-sm text-red-600"},K={key:0,class:"mb-6 p-4 bg-blue-50 rounded-lg"},Q={class:"mb-4"},W={key:0,class:"mt-1 text-sm text-red-600"},X={key:1,class:"mb-6 p-4 bg-blue-50 rounded-lg"},Z={class:"mb-4"},ee={key:0,class:"mt-1 text-sm text-red-600"},te={class:"mb-6"},oe={key:0,class:"mt-1 text-sm text-red-600"},re={class:"mb-6"},se={key:0,class:"mt-1 text-sm text-red-600"},ie={class:"mb-6"},ne={key:0,class:"mt-1 text-sm text-red-600"},de={class:"pt-4 flex justify-end gap-3"},le=["disabled"],ae={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe=D({__name:"InterventionEditView",setup(ue){const b=E(),x=N(),I=B(),v=h(!1),f=h(!1),y=w(()=>x.params.id),p=w(()=>x.path.includes("/edit")),o=k({type:"",datePlanifiee:"",contratId:"",compteurId:"",technicienId:"",description:"",priorite:""}),r=k({type:"",datePlanifiee:"",contratId:"",compteurId:"",technicienId:"",description:"",priorite:""}),P=async()=>{if(p.value){v.value=!0;try{await b.getInterventionById(y.value);const s=b.getCurrentIntervention;s&&(o.type=s.type,o.datePlanifiee=V(s.datePlanifiee),o.contratId=s.contratId||"",o.compteurId=s.compteurId||"",o.technicienId=s.technicienId||"",o.description=s.description||"",o.priorite=s.priorite||"")}catch(s){console.error("Erreur lors du chargement de l'intervention:",s)}finally{v.value=!1}}},S=()=>{Object.keys(r).forEach(e=>{r[e]=""});let s=!0;return o.type||(r.type="Le type d'intervention est requis",s=!1),o.datePlanifiee||(r.datePlanifiee="La date planifiée est requise",s=!1),o.type==="INSTALLATION"?o.contratId||(r.contratId="Le contrat est requis pour une installation",s=!1):o.type&&(o.compteurId||(r.compteurId="Le compteur est requis pour ce type d'intervention",s=!1)),s},C=async()=>{if(S()){f.value=!0;try{const s={...o,datePlanifiee:new Date(o.datePlanifiee).toISOString()};p.value?await b.createIntervention(s):await b.createIntervention(s),I.push("/dashboard/interventions")}catch(s){console.error("Erreur lors de la sauvegarde de l'intervention:",s)}finally{f.value=!1}}},V=s=>{if(!s)return"";try{return new Date(s).toISOString().substring(0,16)}catch{return""}},g=()=>{I.push(p.value?`/dashboard/interventions/${y.value}`:"/dashboard/interventions")};return A(()=>{P()}),(s,e)=>(n(),i("div",O,[t("div",U,[t("div",q,[t("div",null,[t("div",z,[t("button",{onClick:g,class:"text-blue-600 hover:text-blue-800"},e[7]||(e[7]=[t("i",{class:"fas fa-arrow-left"},null,-1)])),t("h1",R,l(p.value?"Modifier l'intervention":"Nouvelle intervention"),1)]),p.value?(n(),i("p",j," ID: "+l(y.value),1)):a("",!0)])]),t("div",H,[v.value?(n(),i("div",F,e[8]||(e[8]=[T('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-blue-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-gray-500">Chargement...</span></div>',1)]))):(n(),i("form",{key:1,onSubmit:L(C,["prevent"]),class:"p-6"},[t("div",Y,[e[10]||(e[10]=t("label",{for:"type",class:"block text-sm font-medium text-gray-700 mb-1"},"Type d'intervention *",-1)),u(t("select",{id:"type","onUpdate:modelValue":e[0]||(e[0]=d=>o.type=d),required:"",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.type}])},e[9]||(e[9]=[t("option",{value:"",disabled:"",selected:""},"Sélectionnez un type",-1),t("option",{value:"INSTALLATION"},"Installation",-1),t("option",{value:"REPARATION"},"Réparation",-1),t("option",{value:"RELEVE"},"Relevé",-1)]),2),[[_,o.type]]),r.type?(n(),i("p",$,l(r.type),1)):a("",!0)]),t("div",G,[e[11]||(e[11]=t("label",{for:"datePlanifiee",class:"block text-sm font-medium text-gray-700 mb-1"},"Date planifiée *",-1)),u(t("input",{id:"datePlanifiee",type:"datetime-local","onUpdate:modelValue":e[1]||(e[1]=d=>o.datePlanifiee=d),required:"",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.datePlanifiee}])},null,2),[[m,o.datePlanifiee]]),r.datePlanifiee?(n(),i("p",J,l(r.datePlanifiee),1)):a("",!0)]),o.type==="INSTALLATION"?(n(),i("div",K,[e[13]||(e[13]=t("h3",{class:"font-medium text-blue-800 mb-3"},"Informations d'installation",-1)),t("div",Q,[e[12]||(e[12]=t("label",{for:"contratId",class:"block text-sm font-medium text-gray-700 mb-1"},"Contrat associé *",-1)),u(t("input",{id:"contratId",type:"text","onUpdate:modelValue":e[2]||(e[2]=d=>o.contratId=d),placeholder:"ID du contrat",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.contratId}])},null,2),[[m,o.contratId]]),r.contratId?(n(),i("p",W,l(r.contratId),1)):a("",!0)])])):(n(),i("div",X,[e[15]||(e[15]=t("h3",{class:"font-medium text-blue-800 mb-3"},"Informations de l'intervention",-1)),t("div",Z,[e[14]||(e[14]=t("label",{for:"compteurId",class:"block text-sm font-medium text-gray-700 mb-1"},"Compteur associé *",-1)),u(t("input",{id:"compteurId",type:"text","onUpdate:modelValue":e[3]||(e[3]=d=>o.compteurId=d),placeholder:"ID du compteur",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.compteurId}])},null,2),[[m,o.compteurId]]),r.compteurId?(n(),i("p",ee,l(r.compteurId),1)):a("",!0)])])),t("div",te,[e[16]||(e[16]=t("label",{for:"technicienId",class:"block text-sm font-medium text-gray-700 mb-1"},"Technicien assigné",-1)),u(t("input",{id:"technicienId",type:"text","onUpdate:modelValue":e[4]||(e[4]=d=>o.technicienId=d),placeholder:"ID du technicien",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.technicienId}])},null,2),[[m,o.technicienId]]),r.technicienId?(n(),i("p",oe,l(r.technicienId),1)):a("",!0)]),t("div",re,[e[17]||(e[17]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),u(t("textarea",{id:"description","onUpdate:modelValue":e[5]||(e[5]=d=>o.description=d),rows:"4",placeholder:"Description détaillée de l'intervention",class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.description}])},null,2),[[m,o.description]]),r.description?(n(),i("p",se,l(r.description),1)):a("",!0)]),t("div",ie,[e[19]||(e[19]=t("label",{for:"priorite",class:"block text-sm font-medium text-gray-700 mb-1"},"Priorité",-1)),u(t("select",{id:"priorite","onUpdate:modelValue":e[6]||(e[6]=d=>o.priorite=d),class:c(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":r.priorite}])},e[18]||(e[18]=[t("option",{value:"",selected:""},"Standard",-1),t("option",{value:"HAUTE"},"Haute",-1),t("option",{value:"MOYENNE"},"Moyenne",-1),t("option",{value:"BASSE"},"Basse",-1)]),2),[[_,o.priorite]]),r.priorite?(n(),i("p",ne,l(r.priorite),1)):a("",!0)]),t("div",de,[t("button",{type:"button",onClick:g,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Annuler "),t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",disabled:f.value},[f.value?(n(),i("svg",ae,e[20]||(e[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):a("",!0),M(" "+l(p.value?"Mettre à jour":"Créer"),1)],8,le)])],32))])])]))}});export{pe as default};
