import{d as $,u as z,f as y,r as I,o as q,c as d,a as e,g as B,h as x,t as i,w as b,v as _,e as G,i as N,j as f,F as H,k as J,n as g,l as K,m as Q,p as W,q as X,b as u}from"./index-C4yk_1m_.js";const Y={class:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4 md:p-8"},Z={class:"max-w-7xl mx-auto"},ee={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},te={class:"bg-white rounded-xl shadow-md p-5 border-l-4 border-blue-500"},se={class:"flex items-center justify-between"},le={class:"text-2xl font-bold"},oe={class:"bg-white rounded-xl shadow-md p-5 border-l-4 border-yellow-500"},ne={class:"flex items-center justify-between"},ie={class:"text-2xl font-bold"},ae={class:"bg-white rounded-xl shadow-md p-5 border-l-4 border-green-500"},re={class:"flex items-center justify-between"},de={class:"text-2xl font-bold"},ue={class:"bg-white rounded-xl shadow-md p-5 border-l-4 border-red-500"},pe={class:"flex items-center justify-between"},ce={class:"text-2xl font-bold"},xe={class:"bg-white rounded-xl shadow-lg overflow-hidden mb-8"},ge={class:"p-6 border-b"},me={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"},be={class:"p-6"},fe={class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},ye={class:"bg-white divide-y divide-gray-200"},we={key:0},he={key:1},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Ne={class:"px-6 py-4 whitespace-nowrap"},ke={class:"px-6 py-4 text-sm text-gray-700 max-w-xs truncate"},Ce={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Pe={class:"flex justify-end space-x-2"},Ae=["onClick"],Te=["onClick"],Re=["onClick"],Le=["onClick"],Se=["onClick"],Ve={class:"py-3 flex items-center justify-between border-t border-gray-200 mt-4"},Fe={class:"flex-1 flex justify-between sm:hidden"},Me=["disabled"],Ue=["disabled"],je={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Oe={class:"text-sm text-gray-700"},De={class:"font-medium"},$e={class:"font-medium"},ze={class:"font-medium"},qe={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},Be=["disabled"],Ge={class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},He=["disabled"],Qe=$({__name:"InterventionsView",setup(Je){const a=z(),m=Q(),v=y(()=>a.getInterventions),k=y(()=>a.isLoading),l=y(()=>a.getPagination),r=I({total:0,planifiees:0,terminees:0,annulees:0}),n=I({type:"",statut:"",datePlanifieeFrom:"",datePlanifieeTo:"",page:1,limit:10}),C=s=>{try{return W(new Date(s),"dd MMM yyyy",{locale:X})}catch{return s}},P=s=>({INSTALLATION:"Installation",REPARATION:"Réparation",RELEVE:"Relevé"})[s]||s,A=s=>({INSTALLATION:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800",REPARATION:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800",RELEVE:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"})[s]||"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",T=s=>({PLANIFIEE:"Planifiée",EN_COURS:"En cours",TERMINEE:"Terminée",ANNULEE:"Annulée"})[s]||s,R=s=>({PLANIFIEE:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800",EN_COURS:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",TERMINEE:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",ANNULEE:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"})[s]||"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",p=async()=>{try{await a.listInterventions({...n,page:l.value.page,limit:l.value.limit})}catch(s){console.error("Erreur lors du chargement des interventions:",s)}},L=async()=>{try{const[s,t,E,o,c]=await Promise.all([a.listInterventions({limit:1}),a.listInterventions({statut:"PLANIFIEE",limit:1}),a.listInterventions({statut:"EN_COURS",limit:1}),a.listInterventions({statut:"TERMINEE",limit:1}),a.listInterventions({statut:"ANNULEE",limit:1})]);r.total=s.total||0,r.planifiees=t.total||0,r.terminees=o.total||0,r.annulees=c.total||0,p()}catch(s){console.error("Erreur lors du chargement des statistiques:",s)}},S=()=>{Object.keys(n).forEach(s=>{s!=="page"&&s!=="limit"&&(n[s]="")}),n.page=1,p()},V=()=>{n.page=1,p()},w=()=>{l.value.page>1&&(n.page=l.value.page-1,p())},h=()=>{l.value.page<l.value.totalPages&&(n.page=l.value.page+1,p())},F=s=>{m.push(`/dashboard/interventions/${s}`)},M=s=>{m.push(`/dashboard/interventions/${s}/edit`)},U=()=>{m.push("/dashboard/interventions/new")},j=async s=>{try{await a.updateInterventionStatus(s,"EN_COURS"),p()}catch(t){console.error("Erreur lors du démarrage de l'intervention:",t)}},O=s=>{m.push(`/dashboard/interventions/${s}/finish`)},D=async s=>{if(confirm(`Êtes-vous sûr de vouloir annuler l'intervention ${s.id.substring(0,8)}... ?`))try{await a.cancelIntervention(s.id,"Annulé par l'utilisateur"),p()}catch(t){console.error("Erreur lors de l'annulation de l'intervention:",t)}};return q(async()=>{L()}),(s,t)=>{const E=K("router-view");return u(),d("div",Y,[e("div",Z,[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-3xl font-extrabold text-blue-800 flex items-center gap-2"},[e("i",{class:"fas fa-tools"}),x(" Gestion des interventions ")]),e("p",{class:"mt-1 text-gray-600"}," Planifiez, suivez et gérez les interventions techniques ")],-1)),e("div",{class:"mt-4 md:mt-0"},[e("button",{onClick:U,class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition flex items-center gap-2"},t[4]||(t[4]=[e("i",{class:"fas fa-plus"},null,-1),x(" Nouvelle intervention ")]))])]),e("div",ee,[e("div",te,[e("div",se,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-gray-500 text-sm mb-1"},"Total",-1)),e("p",le,i(r.total),1)]),t[7]||(t[7]=e("div",{class:"bg-blue-100 p-3 rounded-full"},[e("i",{class:"fas fa-clipboard-list text-blue-500 text-xl"})],-1))])]),e("div",oe,[e("div",ne,[e("div",null,[t[8]||(t[8]=e("p",{class:"text-gray-500 text-sm mb-1"},"Planifiées",-1)),e("p",ie,i(r.planifiees),1)]),t[9]||(t[9]=e("div",{class:"bg-yellow-100 p-3 rounded-full"},[e("i",{class:"fas fa-calendar-alt text-yellow-500 text-xl"})],-1))])]),e("div",ae,[e("div",re,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-gray-500 text-sm mb-1"},"Terminées",-1)),e("p",de,i(r.terminees),1)]),t[11]||(t[11]=e("div",{class:"bg-green-100 p-3 rounded-full"},[e("i",{class:"fas fa-check-circle text-green-500 text-xl"})],-1))])]),e("div",ue,[e("div",pe,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-gray-500 text-sm mb-1"},"Annulées",-1)),e("p",ce,i(r.annulees),1)]),t[13]||(t[13]=e("div",{class:"bg-red-100 p-3 rounded-full"},[e("i",{class:"fas fa-times-circle text-red-500 text-xl"})],-1))])])]),e("div",xe,[t[34]||(t[34]=e("div",{class:"bg-blue-50 px-6 py-4 border-b border-blue-100"},[e("h2",{class:"text-xl font-semibold text-blue-800"},"Filtres")],-1)),e("div",ge,[e("div",me,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Type",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.type=o),class:"w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500"},t[14]||(t[14]=[e("option",{value:""},"Tous les types",-1),e("option",{value:"INSTALLATION"},"Installation",-1),e("option",{value:"REPARATION"},"Réparation",-1),e("option",{value:"RELEVE"},"Relevé",-1)]),512),[[_,n.type]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Statut",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.statut=o),class:"w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500"},t[16]||(t[16]=[G('<option value="">Tous les statuts</option><option value="PLANIFIEE">Planifiée</option><option value="EN_COURS">En cours</option><option value="TERMINEE">Terminée</option><option value="ANNULEE">Annulée</option>',5)]),512),[[_,n.statut]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date début",-1)),b(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>n.datePlanifieeFrom=o),class:"w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[N,n.datePlanifieeFrom]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date fin",-1)),b(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=o=>n.datePlanifieeTo=o),class:"w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[N,n.datePlanifieeTo]])])]),e("div",{class:"flex justify-end mt-4 gap-2"},[e("button",{onClick:S,class:"px-4 py-2 border border-gray-300 rounded text-gray-700 bg-white hover:bg-gray-50"}," Réinitialiser "),e("button",{onClick:V,class:"px-4 py-2 bg-blue-600 rounded text-white hover:bg-blue-700"}," Appliquer les filtres ")])]),e("div",be,[e("div",fe,[e("table",ve,[t[27]||(t[27]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date planifiée"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Statut"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",ye,[k.value?(u(),d("tr",we,t[20]||(t[20]=[e("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},[e("div",{class:"flex justify-center items-center"},[e("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"ml-2"},"Chargement...")])],-1)]))):v.value.length===0?(u(),d("tr",he,t[21]||(t[21]=[e("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"}," Aucune intervention trouvée ",-1)]))):f("",!0),(u(!0),d(H,null,J(v.value,o=>(u(),d("tr",{key:o.id,class:"hover:bg-blue-50"},[e("td",Ee,i(o.id.substring(0,8))+"... ",1),e("td",Ie,[e("span",{class:g(A(o.type))},i(P(o.type)),3)]),e("td",_e,i(C(o.datePlanifiee)),1),e("td",Ne,[e("span",{class:g(R(o.statut))},i(T(o.statut)),3)]),e("td",ke,i(o.description||"Aucune description"),1),e("td",Ce,[e("div",Pe,[e("button",{onClick:c=>F(o.id),class:"text-blue-600 hover:text-blue-800",title:"Voir les détails"},t[22]||(t[22]=[e("i",{class:"fas fa-eye"},null,-1)]),8,Ae),e("button",{onClick:c=>M(o.id),class:"text-yellow-600 hover:text-yellow-800",title:"Modifier"},t[23]||(t[23]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Te),o.statut==="PLANIFIEE"?(u(),d("button",{key:0,onClick:c=>D(o),class:"text-red-600 hover:text-red-800",title:"Annuler"},t[24]||(t[24]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,Re)):f("",!0),o.statut==="PLANIFIEE"?(u(),d("button",{key:1,onClick:c=>j(o.id),class:"text-green-600 hover:text-green-800",title:"Démarrer"},t[25]||(t[25]=[e("i",{class:"fas fa-play"},null,-1)]),8,Le)):f("",!0),o.statut==="EN_COURS"?(u(),d("button",{key:2,onClick:c=>O(o.id),class:"text-green-600 hover:text-green-800",title:"Terminer"},t[26]||(t[26]=[e("i",{class:"fas fa-check-circle"},null,-1)]),8,Se)):f("",!0)])])]))),128))])])]),e("div",Ve,[e("div",Fe,[e("button",{onClick:w,disabled:l.value.page<=1,class:g(["relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",{"opacity-50 cursor-not-allowed":l.value.page<=1}])}," Précédent ",10,Me),e("button",{onClick:h,disabled:l.value.page>=l.value.totalPages,class:g(["ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",{"opacity-50 cursor-not-allowed":l.value.page>=l.value.totalPages}])}," Suivant ",10,Ue)]),e("div",je,[e("div",null,[e("p",Oe,[t[28]||(t[28]=x(" Affichage de ")),e("span",De,i(v.value.length?(l.value.page-1)*l.value.limit+1:0),1),t[29]||(t[29]=x(" à ")),e("span",$e,i(Math.min(l.value.page*l.value.limit,l.value.total)),1),t[30]||(t[30]=x(" sur ")),e("span",ze,i(l.value.total),1),t[31]||(t[31]=x(" résultats "))])]),e("div",null,[e("nav",qe,[e("button",{onClick:w,disabled:l.value.page<=1,class:g(["relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",{"opacity-50 cursor-not-allowed":l.value.page<=1}])},t[32]||(t[32]=[e("span",{class:"sr-only"},"Précédent",-1),e("i",{class:"fas fa-chevron-left"},null,-1)]),10,Be),e("span",Ge," Page "+i(l.value.page)+" sur "+i(l.value.totalPages||1),1),e("button",{onClick:h,disabled:l.value.page>=l.value.totalPages,class:g(["relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",{"opacity-50 cursor-not-allowed":l.value.page>=l.value.totalPages}])},t[33]||(t[33]=[e("span",{class:"sr-only"},"Suivant",-1),e("i",{class:"fas fa-chevron-right"},null,-1)]),10,He)])])])])])]),B(E)])])}}});export{Qe as default};
