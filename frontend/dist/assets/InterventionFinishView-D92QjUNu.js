import{d as L,z as A,f as y,r as D,g as N,h,o as S,c as n,a as t,t as i,x as R,m as T,p as u,n as b,v as f,q as x,k as B,B as M,C as z,y as j,b as a}from"./index-DoIS1nPs.js";const P={class:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4 md:p-8"},F={class:"max-w-4xl mx-auto"},O={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},q={class:"mt-1 text-gray-600"},U={class:"bg-white rounded-xl shadow-md overflow-hidden"},H={key:0,class:"p-8 flex justify-center"},G={class:"mb-6 bg-blue-50 rounded-lg p-4"},$={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},J={class:"font-medium"},K={class:"font-medium"},Q={key:0},W={class:"font-medium"},X={key:1},Y={class:"font-medium"},Z={key:2,class:"col-span-2"},ee={class:"font-medium"},te={class:"mb-6"},se={key:0,class:"mt-1 text-sm text-red-600"},re={class:"mb-6"},le={key:0,class:"mt-1 text-sm text-red-600"},oe={key:0,class:"mb-6"},ne={key:0,class:"mt-1 text-sm text-red-600"},ae={key:1,class:"mb-6"},ie={key:0,class:"mt-1 text-sm text-red-600"},ue={class:"pt-4 flex justify-end gap-3"},de=["disabled"],ce={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe=L({__name:"InterventionFinishView",setup(me){const m=A(),k=N(),g=j(),I=y(()=>m.isLoading),v=D(!1),c=y(()=>k.params.id),o=y(()=>m.getCurrentIntervention),r=h({resultat:"",cout:null,valeurReleve:null,piecesRemplacees:"",dateFinIntervention:new Date().toISOString()}),l=h({resultat:"",cout:"",valeurReleve:"",piecesRemplacees:""}),_=s=>{if(!s)return"";try{return M(new Date(s),"dd MMM yyyy à HH:mm",{locale:z})}catch{return s}},w=s=>s?{INSTALLATION:"Installation",REPARATION:"Réparation",RELEVE:"Relevé"}[s]||s:"",C=async()=>{try{await m.getInterventionById(c.value),o.value?.statut!=="EN_COURS"&&(alert("Cette intervention ne peut pas être terminée car elle n'est pas en cours."),p())}catch(s){console.error("Erreur lors du chargement de l'intervention:",s),p()}},E=()=>{Object.keys(l).forEach(e=>{l[e]=""});let s=!0;return(!r.resultat||r.resultat.trim()==="")&&(l.resultat="Le résultat de l'intervention est requis",s=!1),r.cout!==null&&r.cout<0&&(l.cout="Le coût ne peut pas être négatif",s=!1),o.value?.type==="RELEVE"&&!r.valeurReleve&&r.valeurReleve!==0&&(l.valeurReleve="La valeur du relevé est requise",s=!1),s},V=async()=>{if(E()){v.value=!0;try{const s={resultat:r.resultat,dateFinIntervention:r.dateFinIntervention};r.cout!==null&&(s.cout=r.cout),o.value?.type==="RELEVE"&&r.valeurReleve!==null&&(s.valeurReleve=r.valeurReleve),await m.finishIntervention(c.value,s),g.push(`/dashboard/interventions/${c.value}`)}catch(s){console.error("Erreur lors de la terminaison de l'intervention:",s)}finally{v.value=!1}}},p=()=>{g.push(`/dashboard/interventions/${c.value}`)};return S(()=>{C()}),(s,e)=>(a(),n("div",P,[t("div",F,[t("div",O,[t("div",null,[t("div",{class:"flex items-center gap-3"},[t("button",{onClick:p,class:"text-blue-600 hover:text-blue-800"},e[4]||(e[4]=[t("i",{class:"fas fa-arrow-left"},null,-1)])),e[5]||(e[5]=t("h1",{class:"text-2xl font-bold text-blue-800"}," Terminer l'intervention ",-1))]),t("p",q," Intervention #"+i(c.value)+" - "+i(w(o.value?.type)),1)])]),t("div",U,[I.value?(a(),n("div",H,e[6]||(e[6]=[R('<div class="flex flex-col items-center"><svg class="animate-spin h-8 w-8 text-blue-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-gray-500">Chargement des détails de l&#39;intervention...</span></div>',1)]))):(a(),n("form",{key:1,onSubmit:T(V,["prevent"]),class:"p-6"},[t("div",G,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-blue-800 mb-2"},"Résumé de l'intervention",-1)),t("div",$,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm text-gray-500"},"Type:",-1)),t("p",J,i(w(o.value?.type)),1)]),t("div",null,[e[8]||(e[8]=t("p",{class:"text-sm text-gray-500"},"Date planifiée:",-1)),t("p",K,i(_(o.value?.datePlanifiee)),1)]),o.value?.contratId?(a(),n("div",Q,[e[9]||(e[9]=t("p",{class:"text-sm text-gray-500"},"Contrat associé:",-1)),t("p",W,i(o.value.contratId),1)])):u("",!0),o.value?.compteurId?(a(),n("div",X,[e[10]||(e[10]=t("p",{class:"text-sm text-gray-500"},"Compteur associé:",-1)),t("p",Y,i(o.value.compteurId),1)])):u("",!0),o.value?.description?(a(),n("div",Z,[e[11]||(e[11]=t("p",{class:"text-sm text-gray-500"},"Description:",-1)),t("p",ee,i(o.value.description),1)])):u("",!0)])]),t("div",te,[e[13]||(e[13]=t("label",{for:"resultat",class:"block text-sm font-medium text-gray-700 mb-1"},"Résultat de l'intervention *",-1)),b(t("textarea",{id:"resultat","onUpdate:modelValue":e[0]||(e[0]=d=>r.resultat=d),rows:"4",placeholder:"Décrivez le résultat de l'intervention en détail",required:"",class:x(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":l.resultat}])},null,2),[[f,r.resultat]]),l.resultat?(a(),n("p",se,i(l.resultat),1)):u("",!0)]),t("div",re,[e[14]||(e[14]=t("label",{for:"cout",class:"block text-sm font-medium text-gray-700 mb-1"},"Coût de l'intervention (€)",-1)),b(t("input",{id:"cout",type:"number","onUpdate:modelValue":e[1]||(e[1]=d=>r.cout=d),placeholder:"0.00",step:"0.01",min:"0",class:x(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":l.cout}])},null,2),[[f,r.cout]]),l.cout?(a(),n("p",le,i(l.cout),1)):u("",!0)]),o.value?.type==="RELEVE"?(a(),n("div",oe,[e[15]||(e[15]=t("label",{for:"valeurReleve",class:"block text-sm font-medium text-gray-700 mb-1"},"Valeur du relevé (m³) *",-1)),b(t("input",{id:"valeurReleve",type:"number","onUpdate:modelValue":e[2]||(e[2]=d=>r.valeurReleve=d),placeholder:"0.00",step:"0.01",min:"0",required:"",class:x(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":l.valeurReleve}])},null,2),[[f,r.valeurReleve]]),l.valeurReleve?(a(),n("p",ne,i(l.valeurReleve),1)):u("",!0)])):u("",!0),o.value?.type==="REPARATION"?(a(),n("div",ae,[e[16]||(e[16]=t("label",{for:"piecesRemplacees",class:"block text-sm font-medium text-gray-700 mb-1"},"Pièces remplacées",-1)),b(t("textarea",{id:"piecesRemplacees","onUpdate:modelValue":e[3]||(e[3]=d=>r.piecesRemplacees=d),rows:"2",placeholder:"Listez les pièces remplacées",class:x(["w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 focus:ring-blue-500 focus:border-blue-500",{"border-red-500":l.piecesRemplacees}])},null,2),[[f,r.piecesRemplacees]]),l.piecesRemplacees?(a(),n("p",ie,i(l.piecesRemplacees),1)):u("",!0)])):u("",!0),e[19]||(e[19]=R('<div class="mb-6"><div class="flex justify-between items-center mb-2"><label class="block text-sm font-medium text-gray-700">Photos de l&#39;intervention</label><button type="button" class="text-sm text-blue-600">+ Ajouter</button></div><div class="border-2 border-dashed border-gray-300 rounded-md p-8 text-center"><i class="fas fa-camera text-gray-400 text-3xl mb-2"></i><p class="text-gray-500">Aucune photo ajoutée</p><p class="text-xs text-gray-400 mt-1">Formats acceptés: JPG, PNG (max 5MB)</p></div></div>',1)),t("div",ue,[t("button",{type:"button",onClick:p,class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50"}," Annuler "),t("button",{type:"submit",class:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center",disabled:v.value},[v.value?(a(),n("svg",ce,e[17]||(e[17]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):u("",!0),e[18]||(e[18]=B(" Terminer l'intervention "))],8,de)])],32))])])]))}});export{pe as default};
