import{u as T,e as h,r as y,f as w,g as D,h as P,o as _,w as j,c as a,a as t,i as F,j as z,k as c,l as B,t as d,m as R,n,p as m,v as i,q as b,s as L,x as S,y as $,b as u}from"./index-DoP8gccn.js";const O={class:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4 md:p-8"},G={class:"max-w-5xl mx-auto"},H={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-6"},K={class:"flex items-center gap-2 text-sm text-blue-600 mb-2"},X={class:"text-3xl font-extrabold text-blue-800 flex items-center gap-2"},J={key:0},Q={key:1},W={key:0,class:"bg-white rounded-xl shadow-lg p-8 flex flex-col items-center justify-center"},Y={key:1,class:"bg-white rounded-xl shadow-lg p-8 flex flex-col items-center justify-center"},Z={class:"bg-red-100 text-red-600 p-4 rounded-lg mb-4 w-full max-w-lg"},ee={class:"bg-blue-50 px-6 py-4 border-b border-blue-100"},te={class:"text-xl font-semibold text-blue-800"},se={class:"p-6 space-y-8"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={key:0,class:"mt-1 text-sm text-red-600"},re={key:0,class:"mt-1 text-sm text-red-600"},ae={key:0,class:"mt-1 text-sm text-red-600"},ue={key:0,class:"mt-1 text-sm text-red-600"},ne={class:"border-t pt-6"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie=["disabled"],me={key:0,class:"mt-1 text-sm text-amber-600"},ce={class:"border-t pt-6"},be={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"md:col-span-2"},pe={key:0,class:"mt-1 text-sm text-red-600"},ve={key:0,class:"mt-1 text-sm text-red-600"},ge={key:0,class:"mt-1 text-sm text-red-600"},xe={key:1,class:"text-gray-500 italic"},ye={class:"border-t pt-6"},we={key:0,class:"space-y-4"},ke={key:0,class:"bg-blue-50 p-4 rounded-lg"},Ie={class:"text-sm mt-1"},Le={class:"text-sm"},Ne={key:1,class:"text-gray-500 italic"},Se={class:"border-t pt-6"},Ce={class:"border-t pt-6 flex justify-end gap-3"},qe=["disabled"],Ve={key:0,class:"fas fa-spinner fa-spin"},Ae={key:1,class:"fas fa-save"},Ue={__name:"CompteurEditView",setup(Ee){const C=D(),q=$(),k=T(),v=h(),I=y(!1),g=y(!1),x=y(null),l=y({}),f=w(()=>C.params.id),p=w(()=>!!f.value),s=P({numero:"",serialNumber:"",calibre:"",statut:"",marque:"",modele:"",dateFabrication:"",dateInstallation:"",adresse:{rue:"",codePostal:"",ville:""},contratId:"",notes:""}),V=w(()=>s.contratId==="contract-1"?"Martin Dupont":s.contratId==="contract-2"?"Sophie Dubois":s.contratId==="contract-3"?"Thomas Leroy":""),A=w(()=>s.contratId==="contract-1"?"123 Rue du Commerce, 75001 Paris":s.contratId==="contract-2"?"45 Avenue des Fleurs, 69002 Lyon":s.contratId==="contract-3"?"8 Boulevard Maritime, 13008 Marseille":"");_(async()=>{p.value&&await N()}),j(()=>s.statut,o=>{o!=="INSTALLÉ"&&(s.dateInstallation="",s.adresse.rue="",s.adresse.codePostal="",s.adresse.ville="",s.contratId="")});const N=async()=>{if(f.value){I.value=!0,x.value=null;try{const o=await k.getMeterById(f.value);Object.keys(s).forEach(e=>{e==="adresse"?o.adresse&&(s.adresse.rue=o.adresse.rue||"",s.adresse.codePostal=o.adresse.codePostal||"",s.adresse.ville=o.adresse.ville||""):o[e]!==void 0&&(s[e]=o[e])})}catch(o){x.value=o.message||"Erreur lors du chargement des données du compteur",console.error("Erreur chargement compteur:",o)}finally{I.value=!1}}},E=()=>{l.value={};let o=!0;return s.numero||(l.value.numero="Le numéro du compteur est requis",o=!1),s.serialNumber||(l.value.serialNumber="Le numéro de série est requis",o=!1),s.calibre||(l.value.calibre="Le calibre est requis",o=!1),s.statut||(l.value.statut="Le statut est requis",o=!1),s.statut==="INSTALLÉ"&&(s.dateInstallation||(l.value.dateInstallation="La date d'installation est requise pour les compteurs installés",o=!1),s.adresse.rue||(l.value["adresse.rue"]="La rue est requise pour les compteurs installés",o=!1),s.adresse.codePostal||(l.value["adresse.codePostal"]="Le code postal est requis pour les compteurs installés",o=!1),s.adresse.ville||(l.value["adresse.ville"]="La ville est requise pour les compteurs installés",o=!1)),o},M=async()=>{if(!E()){v.error("Erreur","Veuillez corriger les erreurs dans le formulaire");return}g.value=!0;try{const o={...s};if(o.statut!=="INSTALLÉ"&&(delete o.adresse,delete o.contratId),p.value)await k.updateMeter(f.value,o),v.success("Succès","Compteur mis à jour avec succès");else{const e=await k.createMeter(o);v.success("Succès","Compteur créé avec succès"),q.push(`/dashboard/compteurs/${e.id}`)}}catch(o){v.error("Erreur",o.message||"Erreur lors de l'enregistrement du compteur"),console.error("Erreur sauvegarde compteur:",o)}finally{g.value=!1}};return(o,e)=>{const U=B("router-link");return u(),a("div",O,[t("div",G,[t("div",H,[t("div",null,[t("div",K,[F(U,{to:`/dashboard/compteurs/${f.value}`,class:"hover:underline flex items-center"},{default:z(()=>e[14]||(e[14]=[t("i",{class:"fas fa-arrow-left mr-1"},null,-1),c(" Retour au détail du compteur ")])),_:1,__:[14]},8,["to"])]),t("h1",X,[e[15]||(e[15]=t("i",{class:"fas fa-tachometer-alt"},null,-1)),p.value?(u(),a("span",J,"Modifier le compteur")):(u(),a("span",Q,"Ajouter un compteur"))])])]),I.value?(u(),a("div",W,e[16]||(e[16]=[t("i",{class:"fas fa-spinner fa-spin text-3xl text-blue-600 mb-4"},null,-1),t("p",{class:"text-gray-500"},"Chargement des informations...",-1)]))):x.value?(u(),a("div",Y,[t("div",Z,[e[17]||(e[17]=t("div",{class:"font-bold mb-1 flex items-center"},[t("i",{class:"fas fa-exclamation-circle mr-2"}),c(" Erreur ")],-1)),t("p",null,d(x.value),1)]),t("button",{onClick:N,class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition"}," Réessayer ")])):(u(),a("form",{key:2,onSubmit:R(M,["prevent"]),class:"bg-white rounded-xl shadow-lg overflow-hidden"},[t("div",ee,[t("h2",te,d(p.value?"Modifier les informations du compteur":"Informations du nouveau compteur"),1)]),t("div",se,[t("div",null,[e[24]||(e[24]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Informations générales",-1)),t("div",oe,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Numéro du compteur "),t("span",{class:"text-red-600"},"*")],-1)),n(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>s.numero=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value.numero}]),required:""},null,2),[[i,s.numero]]),l.value.numero?(u(),a("p",le,d(l.value.numero),1)):m("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Numéro de série "),t("span",{class:"text-red-600"},"*")],-1)),n(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=r=>s.serialNumber=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value.serialNumber}]),required:""},null,2),[[i,s.serialNumber]]),l.value.serialNumber?(u(),a("p",re,d(l.value.serialNumber),1)):m("",!0)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Calibre (mm) "),t("span",{class:"text-red-600"},"*")],-1)),n(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.calibre=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value.calibre}]),required:""},e[20]||(e[20]=[S('<option value="">Sélectionnez un calibre</option><option value="15">15 mm</option><option value="20">20 mm</option><option value="25">25 mm</option><option value="32">32 mm</option><option value="40">40 mm</option>',6)]),2),[[L,s.calibre]]),l.value.calibre?(u(),a("p",ae,d(l.value.calibre),1)):m("",!0)]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[c(" Statut "),t("span",{class:"text-red-600"},"*")],-1)),n(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.statut=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value.statut}]),required:""},e[22]||(e[22]=[S('<option value="">Sélectionnez un statut</option><option value="ACTIF">Actif</option><option value="EN_STOCK">En stock</option><option value="INSTALLÉ">Installé</option><option value="DÉFECTUEUX">Défectueux</option>',5)]),2),[[L,s.statut]]),l.value.statut?(u(),a("p",ue,d(l.value.statut),1)):m("",!0)])])]),t("div",ne,[e[30]||(e[30]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Spécifications techniques",-1)),t("div",de,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Marque",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=r=>s.marque=r),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"},null,512),[[i,s.marque]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Modèle",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=r=>s.modele=r),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"},null,512),[[i,s.modele]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date de fabrication",-1)),n(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=r=>s.dateFabrication=r),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"},null,512),[[i,s.dateFabrication]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date d'installation",-1)),n(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=r=>s.dateInstallation=r),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",disabled:s.statut!=="INSTALLÉ"},null,8,ie),[[i,s.dateInstallation]]),s.statut==="INSTALLÉ"&&!s.dateInstallation?(u(),a("p",me,e[28]||(e[28]=[t("i",{class:"fas fa-info-circle mr-1"},null,-1),c(" Une date d'installation est requise pour un compteur installé ")]))):m("",!0)])])]),t("div",ce,[e[34]||(e[34]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Emplacement",-1)),s.statut==="INSTALLÉ"?(u(),a("div",be,[t("div",fe,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rue",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=r=>s.adresse.rue=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value["adresse.rue"]}])},null,2),[[i,s.adresse.rue]]),l.value["adresse.rue"]?(u(),a("p",pe,d(l.value["adresse.rue"]),1)):m("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Code postal",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=r=>s.adresse.codePostal=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value["adresse.codePostal"]}])},null,2),[[i,s.adresse.codePostal]]),l.value["adresse.codePostal"]?(u(),a("p",ve,d(l.value["adresse.codePostal"]),1)):m("",!0)]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ville",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=r=>s.adresse.ville=r),class:b(["w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",{"border-red-500":l.value["adresse.ville"]}])},null,2),[[i,s.adresse.ville]]),l.value["adresse.ville"]?(u(),a("p",ge,d(l.value["adresse.ville"]),1)):m("",!0)])])):(u(),a("div",xe," Information d'adresse disponible uniquement pour les compteurs installés "))]),t("div",ye,[e[39]||(e[39]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Association client/contrat",-1)),s.statut==="INSTALLÉ"?(u(),a("div",we,[t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrat associé",-1)),n(t("select",{"onUpdate:modelValue":e[11]||(e[11]=r=>s.contratId=r),class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200"},e[35]||(e[35]=[t("option",{value:""},"Sélectionnez un contrat",-1),t("option",{value:"contract-1"},"Contrat #ABC123",-1),t("option",{value:"contract-2"},"Contrat #DEF456",-1),t("option",{value:"contract-3"},"Contrat #GHI789",-1)]),512),[[L,s.contratId]]),e[37]||(e[37]=t("p",{class:"mt-1 text-xs text-gray-500"}," L'association à un contrat remplira automatiquement les informations client ",-1))]),s.contratId?(u(),a("div",ke,[e[38]||(e[38]=t("p",{class:"text-blue-800 font-medium"},"Informations du contrat",-1)),t("p",Ie,"Client: "+d(V.value),1),t("p",Le,"Adresse: "+d(A.value),1)])):m("",!0)])):(u(),a("div",Ne," Association disponible uniquement pour les compteurs installés "))]),t("div",Se,[e[40]||(e[40]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Notes",-1)),t("div",null,[n(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>s.notes=r),rows:"3",class:"w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"Ajoutez des notes ou commentaires sur ce compteur..."},null,512),[[i,s.notes]])])]),t("div",Ce,[t("button",{type:"button",onClick:e[13]||(e[13]=r=>o.$router.back()),class:"px-5 py-2 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 transition"}," Annuler "),t("button",{type:"submit",class:"px-5 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition flex items-center gap-2",disabled:g.value},[g.value?(u(),a("i",Ve)):(u(),a("i",Ae)),c(" "+d(p.value?"Enregistrer les modifications":"Créer le compteur"),1)],8,qe)])])],32))])])}}};export{Ue as default};
